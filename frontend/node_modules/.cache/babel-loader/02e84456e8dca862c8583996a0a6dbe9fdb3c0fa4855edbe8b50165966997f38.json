{"ast":null,"code":"import express from \"express\";\nimport axios from \"axios\";\nimport request from \"request\";\nimport OpenAI from \"openai\";\nimport dotenv from \"dotenv\";\ndotenv.config(); // <-- load .env\n\nconst router = express.Router();\n\n// ---------- OpenAI client ----------\nconst client = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY\n});\n\n// ---------- LLM: mood → keyword ----------\nasync function getKeywordFromLLM(userMsg) {\n  try {\n    const response = await client.responses.create({\n      model: \"gpt-4o-mini\",\n      input: [{\n        role: \"developer\",\n        content: \"Return a short music keyword (2-4 words only).\"\n      }, {\n        role: \"user\",\n        content: `Convert this mood into a music search keyword: ${userMsg}`\n      }]\n    });\n    return response.output_text.trim();\n  } catch (err) {\n    console.log(\"LLM ERROR:\", err);\n    return \"top trending songs\";\n  }\n}\n\n// ---------- Spotify Token (Official Doc Code) ----------\nasync function getSpotifyToken() {\n  const client_id = process.env.SPOTIFY_CLIENT_ID;\n  const client_secret = process.env.SPOTIFY_CLIENT_SECRET;\n  const authOptions = {\n    url: \"https://accounts.spotify.com/api/token\",\n    headers: {\n      Authorization: \"Basic \" + Buffer.from(client_id + \":\" + client_secret).toString(\"base64\")\n    },\n    form: {\n      grant_type: \"client_credentials\"\n    },\n    json: true\n  };\n  return new Promise((resolve, reject) => {\n    request.post(authOptions, (error, response, body) => {\n      if (!error && response.statusCode === 200) {\n        resolve(body.access_token);\n      } else {\n        console.error(\"SPOTIFY TOKEN ERROR:\", body);\n        reject(new Error(\"Spotify auth failed\"));\n      }\n    });\n  });\n}\n\n// ---------- Spotify Search ----------\nasync function searchSpotify(keyword) {\n  const token = await getSpotifyToken();\n  const res = await axios.get(`https://api.spotify.com/v1/search?q=${encodeURIComponent(keyword)}&type=track&limit=10`, {\n    headers: {\n      Authorization: `Bearer ${token}`\n    }\n  });\n  return res.data.tracks.items.map(track => {\n    var _track$album$images, _track$album$images$;\n    return {\n      title: track.name,\n      artist: track.artists.map(a => a.name).join(\", \"),\n      image: ((_track$album$images = track.album.images) === null || _track$album$images === void 0 ? void 0 : (_track$album$images$ = _track$album$images[0]) === null || _track$album$images$ === void 0 ? void 0 : _track$album$images$.url) || \"\",\n      preview_url: track.preview_url,\n      spotify_url: track.external_urls.spotify\n    };\n  });\n}\n\n// ---------- API Route ----------\nrouter.post(\"/recommend\", async (req, res) => {\n  try {\n    const {\n      message\n    } = req.body;\n    const keyword = await getKeywordFromLLM(message);\n    const songs = await searchSpotify(keyword);\n    res.json({\n      keyword,\n      songs\n    });\n  } catch (err) {\n    console.error(\"SERVER ERROR:\", err);\n    res.status(500).json({\n      error: \"Server failed\"\n    });\n  }\n});\nexport default router;","map":{"version":3,"names":["express","axios","request","OpenAI","dotenv","config","router","Router","client","apiKey","process","env","OPENAI_API_KEY","getKeywordFromLLM","userMsg","response","responses","create","model","input","role","content","output_text","trim","err","console","log","getSpotifyToken","client_id","SPOTIFY_CLIENT_ID","client_secret","SPOTIFY_CLIENT_SECRET","authOptions","url","headers","Authorization","Buffer","from","toString","form","grant_type","json","Promise","resolve","reject","post","error","body","statusCode","access_token","Error","searchSpotify","keyword","token","res","get","encodeURIComponent","data","tracks","items","map","track","_track$album$images","_track$album$images$","title","name","artist","artists","a","join","image","album","images","preview_url","spotify_url","external_urls","spotify","req","message","songs","status"],"sources":["/Users/rushikesh/Documents/WEB-D/music_player_ai/frontend/src/App.js"],"sourcesContent":["import express from \"express\";\nimport axios from \"axios\";\nimport request from \"request\";\nimport OpenAI from \"openai\";\nimport dotenv from \"dotenv\";\n\ndotenv.config(); // <-- load .env\n\nconst router = express.Router();\n\n// ---------- OpenAI client ----------\nconst client = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n});\n\n// ---------- LLM: mood → keyword ----------\nasync function getKeywordFromLLM(userMsg) {\n  try {\n    const response = await client.responses.create({\n      model: \"gpt-4o-mini\",\n      input: [\n        {\n          role: \"developer\",\n          content: \"Return a short music keyword (2-4 words only).\",\n        },\n        {\n          role: \"user\",\n          content: `Convert this mood into a music search keyword: ${userMsg}`,\n        },\n      ],\n    });\n\n    return response.output_text.trim();\n  } catch (err) {\n    console.log(\"LLM ERROR:\", err);\n    return \"top trending songs\";\n  }\n}\n\n// ---------- Spotify Token (Official Doc Code) ----------\nasync function getSpotifyToken() {\n  const client_id = process.env.SPOTIFY_CLIENT_ID;\n  const client_secret = process.env.SPOTIFY_CLIENT_SECRET;\n\n  const authOptions = {\n    url: \"https://accounts.spotify.com/api/token\",\n    headers: {\n      Authorization:\n        \"Basic \" +\n        Buffer.from(client_id + \":\" + client_secret).toString(\"base64\"),\n    },\n    form: {\n      grant_type: \"client_credentials\",\n    },\n    json: true,\n  };\n\n  return new Promise((resolve, reject) => {\n    request.post(authOptions, (error, response, body) => {\n      if (!error && response.statusCode === 200) {\n        resolve(body.access_token);\n      } else {\n        console.error(\"SPOTIFY TOKEN ERROR:\", body);\n        reject(new Error(\"Spotify auth failed\"));\n      }\n    });\n  });\n}\n\n// ---------- Spotify Search ----------\nasync function searchSpotify(keyword) {\n  const token = await getSpotifyToken();\n\n  const res = await axios.get(\n    `https://api.spotify.com/v1/search?q=${encodeURIComponent(\n      keyword\n    )}&type=track&limit=10`,\n    {\n      headers: {\n        Authorization: `Bearer ${token}`,\n      },\n    }\n  );\n\n  return res.data.tracks.items.map((track) => ({\n    title: track.name,\n    artist: track.artists.map((a) => a.name).join(\", \"),\n    image: track.album.images?.[0]?.url || \"\",\n    preview_url: track.preview_url,\n    spotify_url: track.external_urls.spotify,\n  }));\n}\n\n// ---------- API Route ----------\nrouter.post(\"/recommend\", async (req, res) => {\n  try {\n    const { message } = req.body;\n\n    const keyword = await getKeywordFromLLM(message);\n    const songs = await searchSpotify(keyword);\n\n    res.json({ keyword, songs });\n  } catch (err) {\n    console.error(\"SERVER ERROR:\", err);\n    res.status(500).json({ error: \"Server failed\" });\n  }\n});\n\nexport default router;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}